<div class="min-h-screen bg-teal-50">
  <app-sidebar [open]="sidebarOpen" (closeSidebar)="toggleSidebar()"></app-sidebar>

  <div class="p-4 lg:p-6 lg:ml-[260px]">
    <div
      class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 lg:mb-8 gap-4"
    >
      <div class="flex items-center gap-3">
        <button
          (click)="toggleSidebar()"
          type="button"
          class="inline-flex items-center justify-center p-2 bg-teal-700 text-white rounded-md hover:bg-teal-800 lg:hidden"
        >
          <span class="material-icons text-white text-lg">menu</span>
        </button>
        <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900">Stock Mouvements</h1>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 lg:gap-6 mb-6 lg:mb-8">
      <app-stat-card title="Total Mouvements" [value]="totalElements">
        <span class="material-icons text-white text-xs">conveyor_belt</span>
      </app-stat-card>
    </div>

    <div class="bg-white rounded-lg shadow p-4 lg:p-6 mb-6">
      <h2 class="text-base lg:text-lg font-semibold mb-4">Filtres</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4">
        <input
          [(ngModel)]="filter.reference"
          placeholder="Référence"
          (input)="onFilterChange()"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm lg:text-base"
        />
        <select
          [(ngModel)]="filter.type"
          (change)="onFilterChange()"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm lg:text-base"
        >
          <option value="">Tous les types</option>
          <option value="ENTREE">Entrée</option>
          <option value="SORTIE">Sortie</option>
        </select>
        <input
          [(ngModel)]="filter.numeroLot"
          placeholder="Numéro de lot"
          (input)="onFilterChange()"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm lg:text-base sm:col-span-2 lg:col-span-1"
        />
      </div>
    </div>

    <app-error-message [error]="error" (retry)="loadMouvements()"> </app-error-message>

    @if (loading) {
    <div class="flex justify-center items-center py-8 lg:py-12">
      <div
        class="animate-spin rounded-full h-6 w-6 lg:h-8 lg:w-8 border-b-2 border-teal-600"
      ></div>
      <span class="ml-3 text-base lg:text-lg text-gray-600">Chargement...</span>
    </div>
    }

    @if (!loading) {
    <div class="hidden lg:block">
      <app-table
        [columns]="columns"
        [data]="mouvements"
        [loading]="loading"
        emptyMessage="Aucun mouvement trouvé"
      >
      </app-table>
    </div>
    }

    @if (!loading && mouvements.length > 0) {
    <div class="block lg:hidden space-y-3">
      @for (mouvement of mouvements; track mouvement.id) {
      <app-mobile-card [data]="mouvement" [fields]="cardFields" titleField="reference">
      </app-mobile-card>
      }
    </div>
    }

    @if (!loading && mouvements.length === 0) {
    <div class="block lg:hidden text-center py-8 text-gray-500">Aucun mouvement trouvé</div>
    }

    <div class="flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-4 mt-6">
      <button
        (click)="previousPage()"
        [disabled]="currentPage === 0"
        type="button"
        class="w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Précédent
      </button>
      <span class="text-sm text-gray-700 order-first sm:order-none">
        Page {{ currentPage + 1 }} sur {{ Math.ceil(totalElements / pageSize) }}
      </span>
      <button
        (click)="nextPage()"
        type="button"
        class="w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Suivant
      </button>
    </div>
  </div>
</div>
