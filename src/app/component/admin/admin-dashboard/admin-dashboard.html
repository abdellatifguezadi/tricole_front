<div class="min-h-screen bg-gray-50">
  <app-sidebar [open]="sidebarOpen" (closeSidebar)="toggleSidebar()"></app-sidebar>

  <div class="p-8 lg:ml-[260px]">
    <div class="bg-white border-b border-gray-200 px-8 py-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <!-- Mobile hamburger -->
          <button (click)="toggleSidebar()" type="button" class="inline-flex items-center justify-center p-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 lg:hidden">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>

          <div>
            <h1 class="text-3xl font-bold text-gray-800">Dashboard Admin</h1>
            <p class="text-gray-600 mt-1">Vue d'ensemble des statistiques</p>
          </div>
        </div>
        <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="p-8">
      <app-error-message
        [error]="error"
        (retry)="loadStats()">
      </app-error-message>

      @if (stats) {
      <div class="space-y-8">
        <!-- Statistiques principales -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <app-stat-card title="Total Utilisateurs" [value]="stats.totalUtilisateurs">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </app-stat-card>

          <app-stat-card title="Total Produits" [value]="stats.totalProduits">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
            </svg>
          </app-stat-card>

          <app-stat-card title="Total Fournisseurs" [value]="stats.totalFournisseurs">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </app-stat-card>

          <app-stat-card title="Total Commandes" [value]="stats.totalCommandes">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7 4V2c0-1.1.9-2 2-2h6c1.1 0 2 .9 2 2v2h5v2h-2v13c0 1.1-.9 2-2 2H6c-1.1 0-2-.9-2-2V6H2V4h5zM9 2v2h6V2H9zm0 4v12h6V6H9z"/>
            </svg>
          </app-stat-card>
        </div>

        <!-- Statistiques financières -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <app-stat-card
            title="Valeur Total Stock"
            [value]="stats.valeurTotalStock + ' €'">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </app-stat-card>

          <app-stat-card
            title="Montant Total Commandes"
            [value]="stats.montantTotalCommandes + ' €'">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
            </svg>
          </app-stat-card>

          <app-stat-card
            title="Montant Total Sorties"
            [value]="stats.montantTotalSorties + ' €'">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
          </app-stat-card>
        </div>

        @if (stats.produitsEnRupture > 0 || stats.produitsProchesRupture > 0 || stats.commandesEnRetard > 0) {
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          @if (stats.produitsEnRupture > 0) {
          <app-alert-card
            title="Produits en rupture"
            [message]="stats.produitsEnRupture + ' produits en rupture de stock'"
            type="error">
          </app-alert-card>
          }

          @if (stats.produitsProchesRupture > 0) {
          <app-alert-card
            title="Produits proches rupture"
            [message]="stats.produitsProchesRupture + ' produits proches de la rupture'"
            type="warning">
          </app-alert-card>
          }

          @if (stats.commandesEnRetard > 0) {
          <app-alert-card
            title="Commandes en retard"
            [message]="stats.commandesEnRetard + ' commandes en retard'"
            type="error">
          </app-alert-card>
          }
        </div>
        }

        <!-- Graphiques et données groupées -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <app-chart-card
            title="Utilisateurs par Rôle"
            [data]="stats.utilisateursParRole">
          </app-chart-card>

          <app-chart-card
            title="Commandes par Statut"
            [data]="stats.commandesParStatut">
          </app-chart-card>

          <app-chart-card
            title="Bons Sortie par Statut"
            [data]="stats.bonsSortieParStatut">
          </app-chart-card>

          <app-chart-card
            title="Sorties par Atelier"
            [data]="stats.sortiesParAtelier">
          </app-chart-card>
        </div>

        <!-- Statistiques mensuelles -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <app-stat-card
            title="Nouvelles Commandes (Mois)"
            [value]="stats.nouvellesCommandesMois">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
            </svg>
          </app-stat-card>

          <app-stat-card
            title="Nouveaux Bons Sortie (Mois)"
            [value]="stats.nouveauxBonsSortieMois">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
            </svg>
          </app-stat-card>

          <app-stat-card
            title="Mouvements Stock (Mois)"
            [value]="stats.mouvementStockMois">
            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
          </app-stat-card>
        </div>
      </div>
      }

      @if (!stats) {
      <div class="flex justify-center items-center h-64">
        <div class="text-center">
          <div class="w-16 h-16 border-4 border-black border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p class="text-gray-600 font-medium">Chargement des statistiques...</p>
        </div>
      </div>
      }
    </div>
  </div>
</div>
